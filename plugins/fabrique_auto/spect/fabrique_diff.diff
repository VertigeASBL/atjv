diff -r -x . -x .. -x fabrique_diff.diff -x fabrique_spect.php ../plugins/fabrique_auto/.backup/spect/formulaires/editer_spectacle.php ../plugins/fabrique_auto/spect/formulaires/editer_spectacle.php
16,17c16,17
< function formulaires_editer_spectacle_identifier_dist($id_spectacle='new', $retour='', $lier_trad=0, $config_fonc='', $row=array(), $hidden=''){
< 	return serialize(array(intval($id_spectacle)));
---
> function formulaires_editer_spectacle_identifier_dist($id_spectacle='new', $retour='', $associer_objet='', $lier_trad=0, $config_fonc='', $row=array(), $hidden=''){
> 	return serialize(array(intval($id_spectacle), $associer_objet));
23c23
< function formulaires_editer_spectacle_charger_dist($id_spectacle='new', $retour='', $lier_trad=0, $config_fonc='', $row=array(), $hidden=''){
---
> function formulaires_editer_spectacle_charger_dist($id_spectacle='new', $retour='', $associer_objet='', $lier_trad=0, $config_fonc='', $row=array(), $hidden=''){
31c31
< function formulaires_editer_spectacle_verifier_dist($id_spectacle='new', $retour='', $lier_trad=0, $config_fonc='', $row=array(), $hidden=''){
---
> function formulaires_editer_spectacle_verifier_dist($id_spectacle='new', $retour='', $associer_objet='', $lier_trad=0, $config_fonc='', $row=array(), $hidden=''){
38,39c38,54
< function formulaires_editer_spectacle_traiter_dist($id_spectacle='new', $retour='', $lier_trad=0, $config_fonc='', $row=array(), $hidden=''){
< 	return formulaires_editer_objet_traiter('spectacle',$id_spectacle,'',$lier_trad,$retour,$config_fonc,$row,$hidden);
---
> function formulaires_editer_spectacle_traiter_dist($id_spectacle='new', $retour='', $associer_objet='', $lier_trad=0, $config_fonc='', $row=array(), $hidden=''){
> 	$res = formulaires_editer_objet_traiter('spectacle',$id_spectacle,'',$lier_trad,$retour,$config_fonc,$row,$hidden);
>
> 	// Un lien a prendre en compte ?
> 	if ($associer_objet AND $id_spectacle = $res['id_spectacle']) {
> 		list($objet, $id_objet) = explode('|', $associer_objet);
>
> 		if ($objet AND $id_objet AND autoriser('modifier', $objet, $id_objet)) {
> 			include_spip('action/editer_liens');
> 			objet_associer(array('spectacle' => $id_spectacle), array($objet => $id_objet));
> 			if (isset($res['redirect'])) {
> 				$res['redirect'] = parametre_url ($res['redirect'], "id_lien_ajoute", $id_spectacle, '&');
> 			}
> 		}
> 	}
> 	return $res;
>
diff -r -x . -x .. -x fabrique_diff.diff -x fabrique_spect.php ../plugins/fabrique_auto/.backup/spect/paquet.xml ../plugins/fabrique_auto/spect/paquet.xml
12c12
< 		Paquet généré le 2013-01-25 15:58:36
---
> 		Paquet généré le 2013-01-25 15:58:46
Only in ../plugins/fabrique_auto/spect/prive/objets/liste: spectacles_associer.html
Only in ../plugins/fabrique_auto/spect/prive/objets/liste: spectacles_associer_fonctions.php
Only in ../plugins/fabrique_auto/spect/prive/objets/liste: spectacles_lies.html
Only in ../plugins/fabrique_auto/spect/prive/objets/liste: spectacles_lies_fonctions.php
Only in ../plugins/fabrique_auto/spect/prive/squelettes/contenu: spectacle_edit.html